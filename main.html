<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
    <title>Laobzhang</title>
     <script src="//cdn.bootcss.com/Chart.js/2.7.1/Chart.bundle.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="static/semantic.js"></script>
    <link href="static/semantic.css" rel="stylesheet">
     <style>

    </style>
</head>
<body>

<div class="ui container" id="selector1">
<select class="ui search dropdown selection" v-model="base_select" @change="firstd()">
  <option>事业部</option>
  <option v-for="(value,key) in department" :value=key>{{key}}</option>
</select>
<select class="ui search dropdown selection" v-model="first_select" @change="secondd()">
  <option>一级部门</option>
  <option v-for="(value,key) in department[base_select]" :value=key>{{key}}</option>
</select>
<select class="ui search dropdown selection" v-model="second_select">
  <option>二级部门</option>
  <option v-for="(key,index) in first_value" :value=key>{{key}}</option>
</select>
    <div class="ui blue button d_submit">提交</div>
</div>


<div id="vuetest" class="ui container">
    <h2 class="ui dividing header">总览</h2>
    <h2 class="ui dividing header">绩效打分明细</h2>
<table class="ui celled table">
    <thead>
    <tr>
        <th v-for="title in table1_head">{{title}}</th>

    </tr>
    </thead>
    <tbody>
    <tr v-for="(each_data, index) in staff_data">
        <td v-for="title in table1_head">{{each_data[title]}}</td>
    </tr>
    </tbody>
</table>
    <h2 class="ui dividing header">能力素质情况</h2>
<table class="ui celled table">
    <thead>
    <tr>
        <th v-for="title in table2_head">{{title}}</th>
        <th> 雷达图 </th>
    </tr>
    </thead>
    <tbody>
    <tr v-for="(each_data, index) in staff_data">

        <td v-for="title in table2_head">{{each_data[title]}}</td>
        <td><button class="ui yellow button" @click="showRadar(each_data)">雷达图</button></td>

    </tr>
    <tr>
        <td>部门平均分</td>
        <td v-for="num in team.score">{{num}}</td><td></td><td></td>
    </tr>
    </tbody>
</table>
<!-- 展示canvas -->
 <div>
    <canvas id="myChart"></canvas>
 </div>
<h2 class="ui dividing header">人才盘点九宫图</h2>
     <div>
    <canvas id="myBubble"></canvas>
 </div>
</div>

<!--引入 chartjs-->



<script>

//    $('.tag.example .ui.dropdown').dropdown({
//    allowAdditions: true});

    var vselect = new Vue({
        el: '#selector1',
        data: {
            department: [],
            base_select:"事业部",
            first_select:"一级部门",
            second_select:"二级部门",
            first_value:""
        },
        methods: {
            firstd:function () {
                vselect.first_select = '一级部门';
            },
            secondd:function () {
                vselect.second_select = '二级部门';
                vselect.first_value = vselect.department[vselect.base_select][vselect.first_select]
            },
            first_value:function () {

            }

        }
    });

    var vm = new Vue({
        el: '#vuetest',
        data: {
            head: ["团队建设","员工培养","协调安排","合理授权"],
            team:{
                "name":"部门平均分",
                "score":[25, 25, 25, 25]
            },
            person:{
                "name":"laobzhang",
                "score":[18, 19, 19, 23]
            },
            staff_data : [],
            table1_head : [],
            table2_head : [],
            bubble_data : [],
        },
        methods: {
            showRadar: function (user_data) {
                vm.person.score = user_data.person_score;
                vm.person.name = user_data.姓名;

                // 设置参数
                var data = {
                    labels: vm.head,
                    datasets: [
                        {
                            label: vm.person.name,
//            线图填充颜色
                            backgroundColor: "rgba(75,192,192,0.4)",
//            填充边框颜色
                            borderColor: "rgba(75,192,192,1)",
//            顶点颜色
                            pointBackgroundColor: "rgba(75,192,192,1)",
//            顶点圈颜色
                            pointBorderColor: "rgba(75,192,192,1)",
                            pointHoverBackgroundColor: "rgba(75,192,192,1)",
                            pointHoverBorderColor: "rgba(75,192,192,1)",
                            pointColor: "rgba(66,37,186,1)",
                            pointStrokeColor: "#fff",
                            pointHighlightFill: "#fff",
                            pointHighlightStroke: "rgba(220,220,220,1)",
                            data: vm.person.score
                        },
                        {
                            label: vm.team.name,
                            data: vm.team.score
                        }
                    ]
                };


                var options = {
                    scale: {
                        ticks: {
                            min: 0,
                            max: 25
                        }
                    },

                    //Boolean - Whether to show lines for each scale point
                    scaleShowLine: true,

                    //Boolean - Whether we show the angle lines out of the radar
                    angleShowLineOut: true,

                    //Boolean - Whether to show labels on the scale
                    scaleShowLabels: false,

                    // Boolean - Whether the scale should begin at zero
                    scaleBeginAtZero: true,

                    //String - Colour of the angle line
                    angleLineColor: "rgba(0,0,0,.1)",

                    //Number - Pixel width of the angle line
                    angleLineWidth: 1,

                    //String - Point label font declaration
                    pointLabelFontFamily: "'Arial'",

                    //String - Point label font weight
                    pointLabelFontStyle: "normal",

                    //Number - Point label font size in pixels
                    pointLabelFontSize: 10,

                    //String - Point label font colour
                    pointLabelFontColor: "#376658",

                    //Boolean - Whether to show a dot for each point
                    pointDot: true,

                    //Number - Radius of each point dot in pixels
                    pointDotRadius: 3,

                    //Number - Pixel width of point dot stroke
                    pointDotStrokeWidth: 1,

                    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
                    pointHitDetectionRadius: 20,

                    //Boolean - Whether to show a stroke for datasets
                    datasetStroke: true,

                    //Number - Pixel width of dataset stroke
                    datasetStrokeWidth: 2,

                    //Boolean - Whether to fill the dataset with a colour
                    datasetFill: true,

                    scaleStartValue: 0,

                    //String - A legend template
                    legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

                };


                // Get the context of the canvas element we want to select
                var ctx = document.getElementById("myChart").getContext("2d");
                var myRadarChart = new Chart(ctx, {
                    type: 'radar',
                    data: data,
                    options: options
                });

            }
        }
    });

    $(function () {


        first_get_data();

    });

    function first_get_data() {
    $.get(
        "http://198.13.53.253/get_data",
//            "http://localhost/get_data",
        function (res_data) {
            console.log(res_data.bubble_data)
            vm.staff_data = res_data.staff_data;
            vm.table1_head = res_data.table1_head;
            vm.table2_head = res_data.table2_head;
            vm.team.score = res_data.avg_score;
            vm.bubble_data = res_data.bubble_data;
            myBubble()
        });
    $.get(
        "http://198.13.53.253/get_selector",
//        "http://localhost/get_selector",
        function (res_data) {
            console.log(res_data.department_data);
            vselect.department = res_data.department_data

        });
    }
    $('.d_submit').on('click',function () {
        console.log(vselect.first_select);
        var d_data = {"firstd":vselect.first_select,
        "based":vselect.base_select,"secondd":vselect.second_select};
        $.get("http://198.13.53.253/get_data",d_data,
            function (res_data) {
                console.log(res_data.staff_data);
                vm.staff_data = res_data.staff_data;
                vm.table1_head = res_data.table1_head;
                vm.table2_head = res_data.table2_head;
                vm.team.score = res_data.avg_score;
                vm.bubble_data = res_data.bubble_data;
                myBubble()
            });
    });
    var bubble_options = {
                    scales: {

                        yAxes: [{
                            id: 'left-y-axis',
                            type: 'linear',
                            position: 'left',
                            ticks: {
                                min: 55,
                                max: 100
                            }
                        }],
                        xAxes: [{
                            id: 'left-x-axis',
                            type: 'linear',
                            position: 'left',
                            ticks: {
                                min: 55,
                                max: 100
                            }
                        }]
                    }};

    function myBubble() {
            var ctx1 = document.getElementById("myBubble").getContext("2d");
                    var myBubble = new Chart(ctx1, {
                        type: 'bubble',
                        data: {'datasets': vm.bubble_data},
                        options: bubble_options
                    });
    }





</script>
</body>
</html>